import{a as V,b as Y,c as nn}from"./chunk-CRFZIYSY.mjs";import{q as Q,t as M}from"./chunk-K5XJKIFT.mjs";import{a as d}from"./chunk-DPFAQBMX.mjs";import{a as T,c as f,d as g}from"./chunk-NA2H44NE.mjs";import{c as L,d as H,e as X,f as z,g as Z,h as j,i as J}from"./chunk-VQM4LMCW.mjs";import{b as _,d as R,e as B,f as E}from"./chunk-MUKBXGU3.mjs";import{a as K}from"./chunk-TWHTXYMB.mjs";import{e as x}from"./chunk-VDQYAGHU.mjs";import{a as v}from"./chunk-6XMAPYSX.mjs";import{b as w,d as p,e as C}from"./chunk-JPNK6EKM.mjs";import{a as $,b}from"./chunk-ETGZG4G7.mjs";import{a as G,c as U}from"./chunk-RNFDAXUZ.mjs";import{a as I,c as S}from"./chunk-NUBFOYQZ.mjs";import{b as u}from"./chunk-JPG25VX2.mjs";import{b as O}from"./chunk-RV2KJIXD.mjs";import{a as q}from"./chunk-AH44UPM4.mjs";import{a as k}from"./chunk-SOFGN24M.mjs";import{b as D,c as F,f as N,g as P}from"./chunk-HEPV52CH.mjs";import{b as W}from"./chunk-BZMO6Q6L.mjs";import{sha3_256 as on}from"@noble/hashes/sha3";async function Fn(n){if(Q(n))return cn(n);let{moduleAddress:e,moduleName:t,functionName:r}=M(n.function),o=await q(async()=>Y(e,t,r,n.aptosConfig),`entry-function-${n.aptosConfig.network}-${e}-${t}-${r}`,1e3*60*5)();return sn({abi:o,...n})}function sn(n){let e=n.abi,{moduleAddress:t,moduleName:r,functionName:o}=M(n.function),a=V(n.typeArguments);if(a.length!==e.typeParameters.length)throw new Error(`Type argument count mismatch, expected ${e.typeParameters.length}, received ${a.length}`);let i=n.functionArguments.map((s,A)=>nn(n.function,e,s,A,a));if(i.length!==e.parameters.length)throw new Error(`Too few arguments for '${t}::${r}::${o}', expected ${e.parameters.length} but got ${i.length}`);let c=z.build(`${t}::${r}`,o,a,i);if("multisigAddress"in n){let s=u.from(n.multisigAddress);return new X(new j(s,new J(c)))}return new H(c)}function cn(n){return new L(new Z(W.fromHexInput(n.bytecode).toUint8Array(),n.typeArguments??[],n.functionArguments))}async function un(n){let{aptosConfig:e,sender:t,payload:r,options:o,feePayerAddress:a}=n,i=x[e.network]?Promise.resolve({chain_id:x[e.network]}):k({aptosConfig:e}),c=o?.gasUnitPrice?Promise.resolve({gas_estimate:o.gasUnitPrice}):O({aptosConfig:e}),[{chain_id:s},{gas_estimate:A}]=await Promise.all([i,c]),y=o?.accountSequenceNumber!==void 0?Promise.resolve({sequence_number:o.accountSequenceNumber}):v({aptosConfig:e,accountAddress:t}),m;if(a&&u.from(a).equals(u.ZERO))try{let{sequence_number:l}=await y;m=l}catch{m="0"}else{let{sequence_number:l}=await y;m=l}let{maxGasAmount:en,gasUnitPrice:an,expireTimestamp:rn}={maxGasAmount:o?.maxGasAmount?BigInt(o.maxGasAmount):BigInt(2e5),gasUnitPrice:BigInt(A),expireTimestamp:BigInt(Math.floor(Date.now()/1e3)+20),...o};return new T(u.from(t),BigInt(m),r,BigInt(en),BigInt(an),BigInt(rn),new K(s))}async function Nn(n){let{aptosConfig:e,sender:t,payload:r,options:o,feePayerAddress:a}=n,i=await un({aptosConfig:e,sender:t,payload:r,options:o,feePayerAddress:a});if("secondarySignerAddresses"in n){let c=n.secondarySignerAddresses?.map(s=>u.from(s))??[];return{rawTransaction:i,secondarySignerAddresses:c,feePayerAddress:n.feePayerAddress?u.from(n.feePayerAddress):void 0}}return{rawTransaction:i,feePayerAddress:n.feePayerAddress?u.from(n.feePayerAddress):void 0}}function Wn(n){let{signerPublicKey:e,transaction:t,secondarySignersPublicKeys:r,feePayerPublicKey:o}=n,a=h(e);if(t.feePayerAddress){let c=new g(t.rawTransaction,t.secondarySignerAddresses??[],t.feePayerAddress),s=[];r&&(s=r.map(m=>h(m)));let A=h(o),y=new B(a,t.secondarySignerAddresses??[],s,{address:t.feePayerAddress,authenticator:A});return new d(c.raw_txn,y).bcsToBytes()}if(t.secondarySignerAddresses){let c=new f(t.rawTransaction,t.secondarySignerAddresses),s=[];s=r.map(y=>h(y));let A=new R(a,t.secondarySignerAddresses,s);return new d(c.raw_txn,A).bcsToBytes()}let i;if(a instanceof w)i=new _(a.public_key,a.signature);else if(a instanceof p)i=new E(a);else throw new Error("Invalid public key");return new d(t.rawTransaction,i).bcsToBytes()}function h(n){if(n instanceof $){if(n.publicKey instanceof I)return new p(n,new b(new S(new Uint8Array(64))));if(n.publicKey instanceof G)return new p(n,new b(new U(new Uint8Array(64))))}return new w(new I(n.toUint8Array()),new S(new Uint8Array(64)))}function Gn(n){let{signer:e,transaction:t}=n,r=An(t);return e.signWithAuthenticator(r)}function Un(n){let{transaction:e,senderAuthenticator:t,feePayerAuthenticator:r,additionalSignersAuthenticators:o}=n,a=tn(e);if((r||o)&&(a instanceof f||a instanceof g))return dn(a,t,r,o);if(t instanceof w&&a instanceof T){let i=new _(t.public_key,t.signature);return new d(a,i).bcsToBytes()}if((t instanceof p||t instanceof C)&&a instanceof T){let i=new E(t);return new d(a,i).bcsToBytes()}throw new Error(`Cannot generate a signed transaction, ${t} is not a supported account authentication scheme`)}function tn(n){return n.feePayerAddress?new g(n.rawTransaction,n.secondarySignerAddresses??[],n.feePayerAddress):n.secondarySignerAddresses?new f(n.rawTransaction,n.secondarySignerAddresses):n.rawTransaction}function dn(n,e,t,r){if(n instanceof g){if(!t)throw new Error("Must provide a feePayerAuthenticator argument to generate a signed fee payer transaction");let o=new B(e,n.secondary_signer_addresses,r??[],{address:n.fee_payer_address,authenticator:t});return new d(n.raw_txn,o).bcsToBytes()}if(n instanceof f){if(!r)throw new Error("Must provide a additionalSignersAuthenticators argument to generate a signed multi agent transaction");let o=new R(e,n.secondary_signer_addresses,r??[]);return new d(n.raw_txn,o).bcsToBytes()}throw new Error(`Cannot prepare multi signers transaction to submission, ${typeof n} transaction is not supported`)}function An(n){let e=tn(n),t=on.create();if(e instanceof T)t.update(N);else if(e instanceof f)t.update(P);else if(e instanceof g)t.update(P);else throw new Error(`Unknown transaction type to sign on: ${e}`);let r=t.digest(),o=e.bcsToBytes(),a=new Uint8Array(r.length+o.length);return a.set(r),a.set(o,r.length),a}export{Fn as a,sn as b,un as c,Nn as d,Wn as e,h as f,Gn as g,Un as h,tn as i,dn as j,An as k};
//# sourceMappingURL=chunk-FWSOYEN6.mjs.map